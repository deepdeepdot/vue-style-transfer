<html>

<head>
    <title>Using FileReader API with HTML5 Canvas</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
</head>

<body>
    <h1>Hello</h1>
    Resize Image to: <input type="text" style="width:50px;" value="50" id="size" /> %

    <p><input type="file" id="file" multiple /></p>

    <p id="img">
        <img src="" alt="" id="destination">
    </p>
    <img src="images/clouds.jpg" id="source-img"/>


</body>

<script>

    function resize(file) {
        var reader = new FileReader();

        reader.onload = function (e) {
            var img = new Image();

            img.onload = function () {
                var value = $('#size').val();

                // RESIZE THE IMAGES ONE BY ONE.
                img.width = (img.width * value) / 100
                img.height = (img.height * value) / 100

                // SHOW THE IMAGES OF THE BROWSER.
                $('#img').append(img);      

                // CREATE A CANVAS ELEMENT AND ASSIGN THE IMAGES TO IT.
                
                // var canvas = document.createElement("canvas");
                // var ctx = canvas.getContext("2d");
                // ctx.clearRect(0, 0, canvas.width, canvas.height);
                // canvas.width = img.width;
                // canvas.height = img.height;
                // ctx.drawImage(img, 0, 0, img.width, img.height);

                // AUTO DOWNLOAD THE IMAGES, ONCES RESIZED.

                // var a = document.createElement('a');
                // a.href = canvas.toDataURL("image/png");
                // a.download = 'sample.jpg';
                // document.body.appendChild(a);
                // a.click();
            }
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    $(document).ready(function () {
        $('#file').change(function () {
            if (this.files.length > 0) {
                for (var i = 0; i < this.files.length; i++) {
                    let file = this.files[i];
                    resize(file);
                }
            }
        });
    });

    function resizeImageToDestination(source, {width, height, destination}) {
        let ratio = source.width / source.height;
        // alert(ratio + "/" + source.width + "/" + source.height);

        // Compute width and height
        width = width || height && height * ratio || source.width;
        height = height || width && width / ratio || source.height;
        // alert('width:' + width + ", height:" + height);

        let resizedCanvas = document.createElement('canvas');
        resizedCanvas.width = width;
        resizedCanvas.height = height;

        ctx = resizedCanvas.getContext('2d');
        ctx.drawImage(source, 0, 0, source.width, source.height, 0, 0, width, height);
        destination.src = resizedCanvas.toDataURL();
    }

    var resizedImage = document.querySelector('#destination');
    var source = new Image();
    source.onload = function () {
        let width = 320;
        let height = 200;
        resizeImageToDestination(source, { width, height, destination: resizedImage });
    }
    source.src = 'images/chicago.jpg';
</script>

</html>